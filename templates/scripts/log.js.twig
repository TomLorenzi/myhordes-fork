(function() {
    let log_boxes = document.querySelectorAll('.log');
    for (let i = 0; i < log_boxes.length; i++) {

        const has_preloaded_content = log_boxes[i].getAttribute('x-log-default-provided') == '1';
        const url = log_boxes[i].getAttribute('x-log-source');
        let content_box = log_boxes[i].querySelectorAll('.log-content');

        const fun_refresh = function() {
            $.ajax.background().load( content_box[0], url, false )
        };

        let refresh_button = log_boxes[i].querySelector('.log-complete-link');
        if (refresh_button) refresh_button.addEventListener('click', function() {
            let spinner = log_boxes[i].querySelector('.log-spinner');
            refresh_button.classList.add('hidden');
            if (spinner) spinner.classList.remove('hidden');

            fun_refresh();
        });

        if (!has_preloaded_content) fun_refresh();
    }
})();
