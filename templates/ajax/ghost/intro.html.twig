{% extends "ajax/ajax.html.twig" %}
{% block ajax %}
    <div class="row">
        <div class="cell padded header rw-12">
            <h4>{% trans from 'ghost' %}W채hle eine Stadt{% endtrans %}</h4>
            <div class="row">
                <div class="cell rw-8 rw-md-12">
                    {% for townClass in townClasses %}
                        <h5>{{ townClass.getLabel }}</h5>
                        {% if townClass.towns|length > 0 %}
                            <div class="row-table">
                                <div class="row header">
                                    <div class="padded cell rw-8">{% trans from 'ghost' %}Stadtname{% endtrans %}</div>
                                    <div class="padded cell rw-4">{% trans from 'ghost' %}Aktionen{% endtrans %}</div>
                                </div>
                                {% for town in townClass.towns %}
                                    <div class="row">
                                        <div class="padded cell rw-8">{{ town.getName }}</div>
                                        <div class="padded cell rw-1 center"><img class="pointer" alt="+" src="{{ asset('build/images/small_more.gif') }}" /></div>
                                        <div class="padded cell rw-3"><button x-town-id="{{ town.getId }}">Beitreten</button></div>
                                    </div>
                                {% endfor %}
                            </div>

                        {% else %}
                            <span class="small">{% trans from 'ghost' %}Aktuell gibt es keine Stadt diesen Typs.{% endtrans %}</span>
                        {% endif %}
                    {% endfor %}
                </div>
                <div class="cell rw-4 rw-md-12">
                    ADD HELP CONTENT HERE
                </div>
            </div>

        </div>
    </div>
{% endblock %}
{% block js %}
    <script>
        let joinButtons = document.querySelectorAll('button[x-town-id]');
        for (let i = 0; i < joinButtons.length; i++)
            joinButtons[i].addEventListener('click', function (e) {
                e.preventDefault();
                $.ajax.send( '{{ path('api_join') }}', {town: this.getAttribute('x-town-id')},
                    function (data,code) {
                        if (code < 200 || code >= 300)
                            $.html.error('{% trans from 'global' %}Kommunikationsfehler.{% endtrans %}');
                        else if (data.error) {
                            $.html.selectErrorMessage( data.error, {
                                'no_town':        '{% trans from 'ghost' %}Die gew채hlte Stadt wurde nicht gefunden.{% endtrans %}',
                                'town_closed':    '{% trans from 'ghost' %}Die gew채hlte Stadt ist bereits voll.{% endtrans %}',
                                'no_ghost':       '{% trans from 'ghost' %}Du kannst nicht mehr als einer Stadt gleichzeitig beitreten.{% endtrans %}',
                                'in_town':        '{% trans from 'ghost' %}Du bist dieser Stadt bereits beigetreten.{% endtrans %}',
                            }, '{% trans from 'global' %}Allgemeiner Fehler.{% endtrans %}' )
                        } else if (data.success)
                            $.ajax.load(null, '{{ path('game_landing') }}', true);
                        else $.html.error('{% trans from 'ghost' %}Beitritt fehlgeschlagen. Bitte versuche es sp채ter erneut.{% endtrans %}');
                    } )
            })
    </script>
{% endblock %}