{% extends "ajax/game/town/town.html.twig" %}
{% block content %}
    <div class="row">
        <div class="cell padded rw-3 rw-lg-4 rw-md-6 ro-md-3 rw-sm-8 ro-sm-2">
            <div class="well">
                <div class="back"></div>
                <div class="water" style="height: {{ 6 + 59 * min(1.0, (rations_left / 100.0)) }}%"></div>
                <div class="mask"></div>
                <div class="overlay">
                    {% trans with {'%rations%': rations_left} from 'game' %}%rations% Rationen Wasser 체brig{% endtrans %}
                </div>
            </div>
        </div>
        <div class="cell padded rw-9 rw-lg-8 rw-md-12">
            {% if first_take %}
                <button x-well-confirm="0" x-well-direction="up" {% if not allow_take %}disabled{% endif %}>{% trans from 'game' %}Deine Ration Wasser erhalten{% endtrans %}</button>
            {% else %}
                <button x-well-confirm="1" x-well-direction="up" {% if not allow_take %}disabled{% endif %}>{% trans from 'game' %}Eine weitere Ration erhalten{% endtrans %}</button>
            {% endif %}
            <br />
            <button x-well-confirm="1" x-well-direction="down">{% trans from 'game' %}Wasser hinzuf체gen{% endtrans %}</button>
        </div>
    </div>
{% endblock %}
{% block js %}
    {{ parent() }}
    <script>
        const take_water = function( dir ) {
            $.ajax.send( '{{ path('town_well_item_controller') }}', {
                    direction: dir
                },
                function (data,code) {
                    if (code < 200 || code >= 300)
                        $.html.error('{% trans from 'global' %}Kommunikationsfehler.{% endtrans %}');
                    else if (data.error) {
                        $.html.selectErrorMessage( data.error, {
                            'empty':    '{% trans from 'game' %}Der Brunnen ist leer!{% endtrans %}',
                            'locked':   '{% trans from 'game' %}Du kannst heute keine weiteren Rationen entnehmen.{% endtrans %}',
                            'no_water': '{% trans from 'game' %}Hierf체r brauchst du klares Wasser (keine Kanister)!{% endtrans %}'
                        }, '{% trans from 'global' %}Allgemeiner Fehler.{% endtrans %}' )
                    } else if (data.success)
                        $.ajax.load(null, '{{ path('town_well') }}', true);
                    else $.html.error('{% trans from 'global' %}Allgemeiner Fehler.{% endtrans %}');
                } );
        };
        let wellButtons = document.querySelectorAll('*[x-well-confirm]:not([disabled])');
        for (let i = 0; i < wellButtons.length; i++)
            wellButtons[i].addEventListener('click', function() {
                if (this.getAttribute('x-well-confirm') === '1')
                    if (!confirm( '{% trans from 'global' %}Best채tigen?{% endtrans %}' ))
                        return;

                take_water( this.getAttribute('x-well-direction') );
            });
    </script>
{% endblock %}